apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: example-service
spec:
  generators:
  - list:
      elements:
        - env: dev
          server: test-dev
          chart_version: "21.1.23"
  template:
    metadata:
      name: "example-service-{{ env }}"
    spec:
      destination:
        name: "{{ server }}"
        namespace: "example-namespace"
      project: "test-{{ env }}"
      revisionHistoryLimit: 10
      ignoreDifferences:
      - group: apps
        kind: Deployment
        jsonPointers:
        - /spec/replicas
      sources:
        - repoURL: https://charts.bitnami.com/bitnami
          chart: nginx
          targetRevision: "{{ chart_version }}"
          helm:
            releaseName: example-service
            valueFiles:
            - $values/application-sets/example-service/values/values_{{ env }}.yaml
        - repoURL: 'https://github.com/AixaCarrizo/workshop-argocd-applications.git'
          targetRevision: main
          ref: values
